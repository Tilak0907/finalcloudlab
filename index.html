<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>‚òÅÔ∏è Cloud File & Folder Upload using Supabase</title>
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const SUPABASE_URL = "https://kqcvixdtdzvfrijcfvyx.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtxY3ZpeGR0ZHp2ZnJpamNmdnl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4OTU1NDgsImV4cCI6MjA3NzQ3MTU0OH0.rQozBqIErszWOAFGJEpUjO7xdSUqu7uQMB8YuWxYe8s";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const bucketName = "uploads"; 

    document.addEventListener("DOMContentLoaded", () => {
      const fileInput = document.getElementById("fileUpload");
      const status = document.getElementById("status");
      const fileList = document.getElementById("fileList");

      
      fileInput.addEventListener("change", async (e) => {
        const files = e.target.files;
        if (!files.length) return;

        status.textContent = `‚è≥ Uploading ${files.length} file(s)...`;

        try {
          for (const file of files) {
            const relativePath = file.webkitRelativePath || file.name;
            const { error } = await supabase.storage
              .from(bucketName)
              .upload(relativePath, file, { upsert: true });

            if (error) throw error;
          }

          status.textContent = "‚úÖ All files uploaded successfully!";
          loadFiles(); 
        } catch (err) {
          status.textContent = "‚ùå Upload failed: " + err.message;
        }
      });

      
      async function loadFiles() {
        fileList.innerHTML = "‚è≥ Loading files...";
        const { data, error } = await supabase.storage.from(bucketName).list("", {
          limit: 200,
          sortBy: { column: "name", order: "asc" },
        });

        if (error) {
          fileList.innerHTML = "‚ùå Failed to load files: " + error.message;
          return;
        }

        if (!data || data.length === 0) {
          fileList.innerHTML = "<p>No files found.</p>";
          return;
        }

        fileList.innerHTML = "";
        for (const item of data) {
          const fileUrl = `${SUPABASE_URL}/storage/v1/object/public/${bucketName}/${item.name}`;
          const isImage = /\.(jpg|jpeg|png|gif|webp)$/i.test(item.name);
          const fileCard = document.createElement("div");
          fileCard.style.cssText =
            "display:inline-block; margin:15px; padding:10px; border:1px solid #ddd; border-radius:10px; width:200px; box-shadow:0 2px 4px rgba(0,0,0,0.1);";
          fileCard.innerHTML = `
            ${isImage ? `<img src="${fileUrl}" alt="${item.name}" style="width:100%; border-radius:10px;">` : "üìÑ"}
            <p style="font-size:14px; margin-top:5px; word-wrap:break-word;">${item.name}</p>
            <a href="${fileUrl}" target="_blank">Download</a>
          `;
          fileList.appendChild(fileCard);
        }
      }

      loadFiles(); 
    });
  </script>
</head>
<body style="font-family: Poppins, Arial; text-align:center; margin-top:40px;">
  <h1>‚òÅÔ∏è Cloud File & Folder Upload using Supabase</h1>
  <p>Upload multiple files or an entire folder, and view them instantly!</p>

  <div style="margin: 20px;">
    <label style="font-weight: bold;">Select File(s):</label>
    <input type="file" id="fileUpload" webkitdirectory multiple />
    <p style="font-size: 13px; color: gray;">Tip: You can select a folder to upload its entire content.</p>
  </div>

  <p id="status" style="font-weight:600; margin-top:15px;"></p>
  <hr style="margin:40px 0;">
  <h2>üìÇ Uploaded Files</h2>
  <div id="fileList" style="display:flex; flex-wrap:wrap; justify-content:center; gap:10px;"></div>
</body>
</html>
